<div class="login-container">
  <div class="login-card">
    <h1>Gestion de Projets</h1>
    <h2>CrÃ©er un Compte</h2>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="fullName">Nom Complet</label>
        <input type="text" id="fullName" formControlName="fullName" placeholder="Votre nom complet" class="form-input" required>
        @if (submitted && f['fullName'].invalid) {
          <div class="error-message">{{ getErrorMessage('fullName') }}</div>
        }
      </div>
      <div class="form-group">
        <label for="numero">NumÃ©ro de TÃ©lÃ©phone</label>
        <input type="text" id="numero" formControlName="numero" placeholder="Votre numÃ©ro de tÃ©lÃ©phone" class="form-input" required>
        @if (submitted && f['numero'].invalid) {
          <div class="error-message">{{ getErrorMessage('numero') }}</div>
        }
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" formControlName="email" placeholder="votre.email@example.com" class="form-input" required>
        @if (submitted && f['email'].invalid) {
          <div class="error-message">{{ getErrorMessage('email') }}</div>
        }
      </div>

      <div class="form-group">
        <label for="password">Mot de Passe SÃ©curisÃ©</label>
        <div class="password-input-wrapper">
          <input [type]="showPassword ? 'text' : 'password'" id="password" formControlName="password" placeholder="CrÃ©ez un mot de passe fort" class="form-input" required>
          <button type="button" class="password-toggle-btn" (click)="togglePassword()">
            {{ showPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
          </button>
        </div>

        @if (f['password'].value) {
          <div class="password-strength-bar" style="margin-top: 12px;">
            <div class="password-strength-fill" [style.width.%]="(passwordStrength) * 16.666" [style.background-color]="passwordStrengthColor"></div>
          </div>
          <div class="password-strength-label" [style.color]="passwordStrengthColor">
            Force: {{ passwordStrengthLabel }}
          </div>

          <div class="mt-2">
            <div *ngIf="!passwordRequirements.minLength" class="alert alert-danger d-flex align-items-center py-2 px-3 border-0 shadow-sm mb-2">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <small>8 Ã  128 caractÃ¨res.</small>
            </div>

            <div *ngIf="passwordRequirements.minLength && !passwordRequirements.hasUppercase" class="alert alert-danger d-flex align-items-center py-2 px-3 border-0 shadow-sm mb-2">
              <i class="bi bi-capslock-fill me-2"></i>
              <small>Ajoutez une majuscule (A-Z).</small>
            </div>

            <div *ngIf="passwordRequirements.minLength && passwordRequirements.hasUppercase && !passwordRequirements.hasLowercase" class="alert alert-danger d-flex align-items-center py-2 px-3 border-0 shadow-sm mb-2">
              <i class="bi bi-type-lowercase me-2"></i>
              <small>Ajoutez une minuscule (a-z).</small>
            </div>

            <div *ngIf="passwordRequirements.minLength && passwordRequirements.hasUppercase && passwordRequirements.hasLowercase && !passwordRequirements.hasNumber" class="alert alert-danger d-flex align-items-center py-2 px-3 border-0 shadow-sm mb-2">
              <i class="bi bi-123 me-2"></i>
              <small>Ajoutez un chiffre (0-9).</small>
            </div>

            <div *ngIf="passwordRequirements.minLength && passwordRequirements.hasUppercase && passwordRequirements.hasLowercase && passwordRequirements.hasNumber && !passwordRequirements.hasSpecial" class="alert alert-danger d-flex align-items-center py-2 px-3 border-0 shadow-sm mb-2">
              <i class="bi bi-hash me-2"></i>
              <small>Ajoutez un symbole (!@#$%^&*).</small>
            </div>

          </div>
        }
      </div>

      <div class="form-group mt-3">
        <label for="confirmPassword">Confirmer le Mot de Passe</label>
        <div class="password-input-wrapper">
          <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword" formControlName="confirmPassword" placeholder="Confirmez votre mot de passe" class="form-input" required>
          <button type="button" class="password-toggle-btn" (click)="toggleConfirmPassword()">
            {{ showConfirmPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
          </button>
        </div>

        @if (f['confirmPassword'].value) {
          <div [ngClass]="{'password-match': true, 'match': f['password'].value === f['confirmPassword'].value, 'mismatch': f['password'].value !== f['confirmPassword'].value}" class="mt-2">
            <span>{{ f['password'].value === f['confirmPassword'].value ? 'âœ“ Mots de passe identiques' : 'âœ— Le mot de passe ne correspondent pas' }}</span>
          </div>
        }
      </div>
      

  <div class="form-group">
    <label for="role">RÃ´le</label>
    <select id="role" formControlName="role" class="form-select" required
            [ngClass]="{'is-invalid': submitted && f['role'].invalid}">
            <option value="" disabled selected>SÃ©lectionnez votre rÃ´le</option>
            <option value="chef_projet">Chef de Projet</option>
            <option value="Pilote QualitÃ©">Pilote QualitÃ©</option>
            <option value="qualite">Administrateur</option>
    </select>
  
  @if (submitted && f['role'].invalid) {
    <div class="invalid-feedback">
      Veuillez sÃ©lectionner un rÃ´le.
    </div>
  }
</div>  
      <button type="submit" class="btn btn-primary mt-4" [disabled]="loading">
        {{ loading ? 'CrÃ©ation en cours...' : 'CrÃ©er un Compte' }}
      </button>

      <div class="register-link text-center mt-3">
        <p>Vous avez dÃ©jÃ  un compte ? <a routerLink="/login">Se connecter</a></p>
      </div>
    </form>
  </div>
</div>